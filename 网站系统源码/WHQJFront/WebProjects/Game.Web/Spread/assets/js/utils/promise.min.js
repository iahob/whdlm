/**
 * @module promise
 * @author nuintun
 * @license MIT
 * @version 0.0.1
 * @description A pure JavaScript ES6 promise polyfill.
 * @see https://nuintun.github.io/promise
 */
!function(){"use strict";function t(t){return"function"==typeof t&&c.test(t)}function e(t,e){this.task=t,this.args=e}function n(){for(var t=0;t<g.length;t++)g[t].run();g=[],y=!1}function r(t){var n=function(t,e){e>>>=0;var n=t.length;if(e>=n)return[];for(var r=new Array(n-e);n-- >e;)r[n-e]=t[n];return r}(arguments,1);g[g.length]=new e(t,n),y||(y=!0,w())}function i(t){return"function"==typeof t}function o(){this.callbacks=[],this.errbacks=[],this.state="pending",this.value=null,this.chained=!1}function a(t){if(!(this instanceof a))throw new TypeError(this+"is not a promise");if(!i(t))throw new TypeError("Promise resolver "+t+" is not a function");var e=new o;this["<resolver>"]=e;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(n){e.reject(n)}}function s(t,e,n,r){return function(i){var o;try{o=r(i)}catch(a){return n(a)}if(o===t)return n(new TypeError("Cannot resolve a promise with itself"));e(o)}}if(!window.Promise){var c=Function.prototype.toString.call(Function);c=(c=c.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")).replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),c=new RegExp("^"+c+"$");var u=window.MutationObserver||window.WebKitMutationObserver,l={support:function(){return t(u)},install:function(t){var e=0,n=new u(t),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}},f=window.VBArray,h=window.MessageChannel,p={support:function(){return!t(f)&&t(h)},install:function(t){var e=new h;return e.port1.onmessage=t,function(){e.port2.postMessage(0)}}},d={support:function(){return"onreadystatechange"in document.createElement("script")},install:function(t){return function(){var e=document.createElement("script");e.onreadystatechange=function(){t(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},document.documentElement.appendChild(e)}}},v={support:function(){return!0},install:function(t){return function(){setTimeout(t,0)}}};e.prototype.run=function(){var t=this.task,e=this.args;switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);default:return t.apply(null,e)}};for(var w,g=[],y=!1,m=[l,p,d,v],b=0,k=m.length;b<k;b++)if((w=m[b]).support()){w=w.install(n);break}var j=Object.prototype.toString,E=i(Array.isArray)?Array.isArray:function(t){return"[object Array]"===j.call(t)},A=window.console,T=A&&A.error?A.error:function(){};o.prototype={fulfilled:function(t){"pending"===this.state&&(this.value=t,this.state="fulfilled"),"fulfilled"===this.state&&(this.notify(this.callbacks,this.value),this.callbacks=[],this.errbacks=null)},rejected:function(t){"pending"===this.state&&(this.value=t,this.state="rejected"),"rejected"===this.state&&(this.notify(this.errbacks,this.value),this.callbacks=null,this.errbacks=[])},resolve:function(t){var e=this;if("pending"===e.state){if(!t||"object"!=typeof t&&!i(t))return e.fulfilled(t);var n=!1;try{i(t.then)?t.then(function(t){n||(n=!0,e.resolve(t))},function(t){n||(n=!0,e.reject(t))}):e.fulfilled(t)}catch(r){n||e.rejected(r)}}},reject:function(t){"pending"===this.state&&this.rejected(t)},addCallbacks:function(t,e){var n=!1,r=this.callbacks,i=this.errbacks;if(r&&(n=!0,r.push(t)),i&&(n=!0,i.push(e)),n)switch(this.chained=n,this.state){case"fulfilled":this.fulfilled(this.value);break;case"rejected":this.rejected(this.value)}},notify:function(t,e){r(function(n){if(t.length)for(var r=0,i=t.length;r<i;++r)t[r](e);n.chained||"rejected"!==n.state||n.uncaught()},this)},uncaught:function(){var t=this.value;t instanceof Error?T("Uncaught",t.stack||t.name+": "+t.message):T("Uncaught Error:",t)}},a.name="Promise",a.prototype={constructor:a,then:function(t,e){var n,r,o=this["<resolver>"],c=new a(function(t,e){n=t,r=e});return o.addCallbacks(i(t)?s(c,n,r,t):n,i(e)?s(c,n,r,e):r),c},"catch":function(t){return this.then(void 0,t)}},a.resolve=function(t){return t&&t instanceof a?t:new a(function(e){e(t)})},a.reject=function(t){return new a(function(e,n){n(t)})},a.all=function(t){return new a(function(e,n){function r(t){return function(n){i[t]=n,0==--s&&e(i)}}if(!E(t))return n(new TypeError("Promise.all expects an array of values or promises"));var i=[],o=t.length;if(o<1)return e(i);for(var s=o,c=0;c<o;c++)a.resolve(t[c]).then(r(c),n)})},a.race=function(t){return new a(function(e,n){if(!E(t))return n(new TypeError("Promise.race expects an array of values or promises"));for(var r=0,i=t.length;r<i;r++)a.resolve(t[r]).then(e,n)})},window.Promise=a}}();
//# sourceMappingURL=promise.js.map